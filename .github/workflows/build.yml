name: Build BtRemote APK
on: 
  push:
    branches: [ main, master ]  # 推送代码时触发
    tags: [ 'v*' ]             # 打标签时触发
  workflow_dispatch:           # 允许你手动点击按钮触发

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: '17'

      # 这个项目路径太深，我们先跳进去
      - name: Install Flutter and Build
        run: |
          # 1. 找到正确的目录
          cd TCL-BtRemote/TCL-BtRemote/btremote_app
          
          # 2. 这里的项目可能需要先运行 flutter pub get
          # 如果你的仓库里没有 flutter，GitHub 环境自带了
          flutter pub get
          
          # 3. 进入 Android 目录使用作者提到的 gradlew 编译
          cd android
          chmod +x gradlew
          ./gradlew assembleDefaultRelease
        
      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: BtRemote-Release-APK
          # 这里的路径根据作者的 GitLab 配置做了对应修改
          path: "**/app/build/outputs/apk/*/release/*.apk"
